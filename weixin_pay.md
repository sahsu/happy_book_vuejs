# 微信支付

微信支付，按照微信的官方文檔來看不算難。 特別是我們的項目是“傳統的WEB項目”的話。 

但是，對於SPA（單頁應用）來說，就很坑了。 幾乎沒有解釋，文檔也很爛。 

## 優先使用IOS來調試

微信支付帶有一個選項，是可以打印出支付過程中的調試信息的。 

但是我們在使用中發現， Android的微信支付錯誤是不可讀的。也就是說，開啓debug選項是不可用的。 

但是對於蘋果的設備支持的就很好。 所以大家在開發的時候，要先把蘋果設備走通。 

## 微信的支付授權目錄問題

在生產環境下，微信要求對於支付路徑，在微信的管理後臺進行配置，如下圖所示：

![配置支付授權目錄](./images/weixin_pay_config.png)

大家要注意，安卓和IOS的配置是不一樣的。

安卓： 取支付頁面的URL
IOS： 取根路徑URL

例如： 根路徑是： http://yoursite.com,  支付路徑是： http://yoursite.com/#/books/pay?id=3  

那麼，在設置 “支付授權目錄”的時候， 需要設置兩個目錄：

一個是  http://yoursite.com/#/        (給IOS)
一個是  http://yoursite.com/#/books/  (給Android)